---
title: 图片灰度化
date: 2021-02-05 14:46:57
tags:
    - osr
    - 
categories: 机器语言
top: 90
toc: true # 是否启用内容索引
sidebar: true # 是否启用sidebar侧边栏，none：不启用
---
有B语言到C语言,再有go语言
go语言的短小精悍
<!-- more -->
## 图片灰度化

* 加权平均法
* 根据重要性及其它指标，将三个分量以不同的权值进行加权平均。
* 由于人眼对绿色的敏感最高，对蓝色敏感最低，
* 因此，按下式对RGB三分量进行加权平均能得到较合理的灰度图像。
* f(i,j)=0.30R(i,j)+0.59G(i,j)+0.11B(i,j))

```
//定义最大处理图片像素
const MAX_LENGTH  = 2000
//定义图片的长度和高度
var dx,dy int
//定义图片灰度的二维数组
var graySet [2000][2000]int
//定义二值化后图片图片的情况，0代表背景，1代表目标
var binarizationSet [2000][2000]int
var binarizationSetCopy [2000][2000]int
func Gray(path string) string {
	file, err := os.Open(path)
	if err != nil {
		fmt.Println(err)
	}
	defer file.Close()
	pngFile, _ := png.Decode( file )
	bounds := pngFile.Bounds()
	dx = bounds.Max.X
	dy = bounds.Max.Y
	gray := image.NewGray(image.Rect(0, 0, dx, dy))
	var r32,g32,b32 uint32
	var r8,g8,b8 float32
	var newGray byte
	for x := 0; x < dx; x++ {
		for y := 0; y < dy; y++ {
			//计算该点的灰度
			r32, g32, b32, _  = pngFile.At(x, y).RGBA()
			r8,g8,b8 = float32(r32>>8), float32(g32>>8), float32(b32>>8)
			newGray = uint8( 0.299 * r8 + 0.587 * g8 + 0.114 * b8 )
			graySet[x][y] = int(newGray)
			gray.Set(x, y, color.Gray{newGray})
		}
	}
	newPath := "b.png"
	newFile, _ := os.Create(newPath)
	png.Encode(newFile, gray)
	return newPath
}
```

## 相关库

##### 库png方法Decode

从r读取一幅png格式的图像并解码返回该图像。图像的具体类型要看png文件的内容而定

```
func Decode(r io.Reader) (image.Image, error)
```

##### 库png函数DecodeConfig

```
func DecodeConfig(r io.Reader) (image.Config, error)
```

##### 库image的type Config

```
type Config struct {
    ColorModel    color.Model
    Width, Height int
}
```

##### 库png函数Encode

将图像m以PNG格式写入w。任意图像类型都可以被编码，但image.NRGBA以外格式的图像可能会在编码时丢失一些图像信息。

```
func Encode(w io.Writer, m image.Image) error
```

##### 库image的type Image

```
type Image interface {
    // ColorModel方法返回图像的色彩模型
    ColorModel() color.Model
    // Bounds方法返回图像的范围，范围不一定包括点(0, 0)
    Bounds() Rectangle
    // At方法返回(x, y)位置的色彩
    // At(Bounds().Min.X, Bounds().Min.Y)返回网格左上角像素的色彩
    // At(Bounds().Max.X-1, Bounds().Max.Y-1) 返回网格右下角像素的色彩
    At(x, y int) color.Color
}
```

##### 库image的变量Variables

```
var (
    // Black是一个完全不透明的面积无限大的黑色图像
    Black = NewUniform(color.Black)
    // White是一个完全不透明的面积无限大的白色图像
    White = NewUniform(color.White)
    // Transparent是一个完全透明的面积无限大的图像
    Transparent = NewUniform(color.Transparent)
    // Opaque是一个完全不透明的面积无限大的图像
    Opaque = NewUniform(color.Opaque)
)
```

##### 库image的type Point及其方法

```
type Point struct {
    X, Y int
}
func Pt(X, Y int) Point
func (p Point) Eq(q Point) bool
func (p Point) Add(q Point) Point
func (p Point) Sub(q Point) Point
func (p Point) Mul(k int) Point
func (p Point) Div(k int) Point
func (p Point) In(r Rectangle) bool
func (p Point) Mod(r Rectangle) Point
func (p Point) String() string
```

##### 库image的type Rectangle及其方法

```
type Rectangle struct {
    Min, Max Point
}
func Rect(x0, y0, x1, y1 int) Rectangle
func (r Rectangle) Canon() Rectangle
func (r Rectangle) Dx() int
func (r Rectangle) Dy() int
func (r Rectangle) Size() Point
func (r Rectangle) Empty() bool
func (r Rectangle) Eq(s Rectangle) bool
func (r Rectangle) In(s Rectangle) bool
func (r Rectangle) Overlaps(s Rectangle) bool
func (r Rectangle) Add(p Point) Rectangle
func (r Rectangle) Sub(p Point) Rectangle
func (r Rectangle) Intersect(s Rectangle) Rectangle
func (r Rectangle) Union(s Rectangle) Rectangle
func (r Rectangle) Inset(n int) Rectangle
func (r Rectangle) String() string
```

##### 库image的type Uniform

Uniform类型代表一块面积无限大的具有同一色彩的图像。它实现了color.Color、color.Model和Image等接口

```
type Uniform struct {
    C color.Color
}
```

##### 库image的type Alpha

Alpha类型代表一幅内存中的图像，其At方法返回color.Alpha类型的值。

```
type Alpha struct {
    // Pix保管图像的像素，内容为alpha通道值（即透明度）。
    // 像素(x, y)起始位置是Pix[(y-Rect.Min.Y)*Stride + (x-Rect.Min.X)*1]
    Pix []uint8
    // Stride是Pix中每行像素占用的字节数
    Stride int
    // Rect是图像的范围
    Rect Rectangle
}
func NewAlpha(r Rectangle) *Alpha
func (p *Alpha) At(x, y int) color.Color
func (p *Alpha) Bounds() Rectangle
func (p *Alpha) ColorModel() color.Model
func (p *Alpha) Opaque() bool
func (p *Alpha) PixOffset(x, y int) int
func (p *Alpha) Set(x, y int, c color.Color)
func (p *Alpha) SetAlpha(x, y int, c color.Alpha)
func (p *Alpha) SubImage(r Rectangle) Image
```

##### 库image的type Alpha16

```
type Alpha16 struct {
    // Pix保管图像的像素，内容为alpha通道值（即透明度，大端在前的格式）。
    // 像素(x, y)起始位置是Pix[(y-Rect.Min.Y)*Stride + (x-Rect.Min.X)*2]
    Pix []uint8
    // Stride是Pix中每行像素占用的字节数
    Stride int
    // Rect是图像的范围
    Rect Rectangle
}
```

##### 库image的type Gray

```
type Gray struct {
    // Pix保管图像的像素，内容为灰度。
    // 像素(x, y)起始位置是Pix[(y-Rect.Min.Y)*Stride + (x-Rect.Min.X)*1]
    Pix []uint8
    // Stride是Pix中每行像素占用的字节数
    Stride int
    // Rect是图像的范围
    Rect Rectangle
}
func NewGray(r Rectangle) *Gray
func (p *Gray) At(x, y int) color.Color
func (p *Gray) Bounds() Rectangle
func (p *Gray) ColorModel() color.Model
func (p *Gray) Opaque() bool
func (p *Gray) PixOffset(x, y int) int
func (p *Gray) Set(x, y int, c color.Color)
func (p *Gray) SetGray(x, y int, c color.Gray)
func (p *Gray) SubImage(r Rectangle) Image
```

##### 库image的函数NewGray

```
func NewGray(r Rectangle) *Gray
```

##### 库image的函数Rect

```
func Rect(x0, y0, x1, y1 int) Rectangle
```

##### 库image的type Gray16

```
type Gray16 struct {
    // Pix保管图像的像素，内容为灰度（大端在前的格式）。
    // 像素(x, y)起始位置是Pix[(y-Rect.Min.Y)*Stride + (x-Rect.Min.X)*2]
    Pix []uint8
    // Stride是Pix中每行像素占用的字节数
    Stride int
    // Rect是图像的范围
    Rect Rectangle
}
```

库image的type RGBA

```
type RGBA struct {
    // Pix保管图像的像素色彩信息，顺序为R, G, B, A
    // 像素(x, y)起始位置是Pix[(y-Rect.Min.Y)*Stride + (x-Rect.Min.X)*4]
    Pix []uint8
    // Stride是Pix中每行像素占用的字节数
    Stride int
    // Rect是图像的范围
    Rect Rectangle
}
func NewRGBA(r Rectangle) *RGBA
func (p *RGBA) At(x, y int) color.Color
func (p *RGBA) Bounds() Rectangle
func (p *RGBA) ColorModel() color.Model
func (p *RGBA) Opaque() bool
func (p *RGBA) PixOffset(x, y int) int
func (p *RGBA) Set(x, y int, c color.Color)
func (p *RGBA) SetRGBA(x, y int, c color.RGBA)
func (p *RGBA) SubImage(r Rectangle) Image
```

##### 库image的type RGBA64

```
type RGBA64 struct {
    // Pix保管图像的像素色彩信息，顺序为R, G, B, A（每个值都是大端在前的格式）
    // 像素(x, y)起始位置是Pix[(y-Rect.Min.Y)*Stride + (x-Rect.Min.X)*8]
    Pix []uint8
    // Stride是Pix中每行像素占用的字节数
    Stride int
    // Rect是图像的范围
    Rect Rectangle
}
```

库image的type NRGBA

```
type NRGBA struct {
    // Pix保管图像的像素色彩信息，顺序为R, G, B, A
    // 像素(x, y)起始位置是Pix[(y-Rect.Min.Y)*Stride + (x-Rect.Min.X)*4]
    Pix []uint8
    // Stride是Pix中每行像素占用的字节数
    Stride int
    // Rect是图像的范围
    Rect Rectangle
}
```

##### 库image的type NRGBA64

```
type NRGBA64 struct {
    // Pix保管图像的像素色彩信息，顺序为R, G, B, A（每个值都是大端在前的格式）
    // 像素(x, y)起始位置是Pix[(y-Rect.Min.Y)*Stride + (x-Rect.Min.X)*8]
    Pix []uint8
    // Stride是Pix中每行像素占用的字节数
    Stride int
    // Rect是图像的范围
    Rect Rectangle
}
```

##### 库image的type Paletted

Paletted类型是一幅采用uint8类型索引调色板的内存中的图像

```
type Paletted struct {
    // Pix保存图像的象素，内容为调色板的索引。
    // 像素(x, y)的位置是Pix[(y-Rect.Min.Y)*Stride + (x-Rect.Min.X)*1]
    Pix []uint8
    // Stride是Pix中每行像素占用的字节数
    Stride int
    // Rect是图像的范围
    Rect Rectangle
    // Palette是图像的调色板
    Palette color.Palette
}
```

##### 库image的type YCbCrSubsampleRatio

```
type YCbCrSubsampleRatio int
```

##### 库image的type YCbCr

```
type YCbCr struct {
    Y, Cb, Cr      []uint8
    YStride        int
    CStride        int
    SubsampleRatio YCbCrSubsampleRatio
    Rect           Rectangle
}
YcbCr代表采用Y'CbCr色彩模型的一幅内存中的图像。每个像素都对应一个Y采样，但每个Cb/Cr采样对应多个像素。Ystride是两个垂直相邻的像素之间的Y组分的索引增量。CStride是两个映射到单独的色度采样的垂直相邻的像素之间的Cb/Cr组分的索引增量。虽然不作绝对要求，但Ystride字段和len(Y)一般应为8的倍数，并且：
For 4:4:4, CStride == YStride/1 && len(Cb) == len(Cr) == len(Y)/1.
For 4:2:2, CStride == YStride/2 && len(Cb) == len(Cr) == len(Y)/2.
For 4:2:0, CStride == YStride/2 && len(Cb) == len(Cr) == len(Y)/4.
For 4:4:0, CStride == YStride/1 && len(Cb) == len(Cr) == len(Y)/2.
```

##### 库Color

```
Variables
type Color
type Model
func ModelFunc(f func(Color) Color) Model
type Alpha
func (c Alpha) RGBA() (r, g, b, a uint32)
type Alpha16
func (c Alpha16) RGBA() (r, g, b, a uint32)
type Gray
func (c Gray) RGBA() (r, g, b, a uint32)
type Gray16
func (c Gray16) RGBA() (r, g, b, a uint32)
type RGBA
func (c RGBA) RGBA() (r, g, b, a uint32)
type RGBA64
func (c RGBA64) RGBA() (r, g, b, a uint32)
type NRGBA
func (c NRGBA) RGBA() (r, g, b, a uint32)
type NRGBA64
func (c NRGBA64) RGBA() (r, g, b, a uint32)
type YCbCr
func (c YCbCr) RGBA() (uint32, uint32, uint32, uint32)
type Palette
func (p Palette) Convert(c Color) Color
func (p Palette) Index(c Color) int
func RGBToYCbCr(r, g, b uint8) (uint8, uint8, uint8)
func YCbCrToRGB(y, cb, cr uint8) (uint8, uint8, uint8)
```

##### 库color的type Color

实现了Color接口的类型可以将自身转化为预乘了alpha的16位通道的RGBA，转换可能会丢失色彩信息。

```
type Color interface {
    // 方法返回预乘了alpha的红、绿、蓝色彩值和alpha通道值，范围都在[0, 0xFFFF]。
    // 返回值类型为uint32，这样当乘以接近0xFFFF的混合参数时，不会溢出。
    RGBA() (r, g, b, a uint32)
}
```

##### 库color的type Model

Model接口可以将任意Color接口转换为采用自身色彩模型的Color接口。转换可能会丢失色彩信息

```
type Model interface {
    Convert(c Color) Color
}
```

##### 库color的type Gray

```
type Gray struct {
    Y uint8
}
```

##### 库os

```
Constants
Variables
func Hostname() (name string, err error)
func Getpagesize() int
func Environ() []string
func Getenv(key string) string
func Setenv(key, value string) error
func Clearenv()
func Exit(code int)
func Expand(s string, mapping func(string) string) string
func ExpandEnv(s string) string
func Getuid() int
func Geteuid() int
func Getgid() int
func Getegid() int
func Getgroups() ([]int, error)
func Getpid() int
func Getppid() int
type Signal
type PathError
func (e *PathError) Error() string
type LinkError
func (e *LinkError) Error() string
type SyscallError
func (e *SyscallError) Error() string
func NewSyscallError(syscall string, err error) error
type FileMode
func (m FileMode) IsDir() bool
func (m FileMode) IsRegular() bool
func (m FileMode) Perm() FileMode
func (m FileMode) String() string
type FileInfo
func Stat(name string) (fi FileInfo, err error)
func Lstat(name string) (fi FileInfo, err error)
func IsPathSeparator(c uint8) bool
func IsExist(err error) bool
func IsNotExist(err error) bool
func IsPermission(err error) bool
func Getwd() (dir string, err error)
func Chdir(dir string) error
func Chmod(name string, mode FileMode) error
func Chown(name string, uid, gid int) error
func Lchown(name string, uid, gid int) error
func Chtimes(name string, atime time.Time, mtime time.Time) error
func Mkdir(name string, perm FileMode) error
func MkdirAll(path string, perm FileMode) error
func Rename(oldpath, newpath string) error
func Truncate(name string, size int64) error
func Remove(name string) error
func RemoveAll(path string) error
func Readlink(name string) (string, error)
func Symlink(oldname, newname string) error
func Link(oldname, newname string) error
func SameFile(fi1, fi2 FileInfo) bool
func TempDir() string
type File
func Create(name string) (file *File, err error)
func Open(name string) (file *File, err error)
func OpenFile(name string, flag int, perm FileMode) (file *File, err error)
func NewFile(fd uintptr, name string) *File
func Pipe() (r *File, w *File, err error)
func (f *File) Name() string
func (f *File) Stat() (fi FileInfo, err error)
func (f *File) Fd() uintptr
func (f *File) Chdir() error
func (f *File) Chmod(mode FileMode) error
func (f *File) Chown(uid, gid int) error
func (f *File) Readdir(n int) (fi []FileInfo, err error)
func (f *File) Readdirnames(n int) (names []string, err error)
func (f *File) Truncate(size int64) error
func (f *File) Read(b []byte) (n int, err error)
func (f *File) ReadAt(b []byte, off int64) (n int, err error)
func (f *File) Write(b []byte) (n int, err error)
func (f *File) WriteString(s string) (ret int, err error)
func (f *File) WriteAt(b []byte, off int64) (n int, err error)
func (f *File) Seek(offset int64, whence int) (ret int64, err error)
func (f *File) Sync() (err error)
func (f *File) Close() error
type ProcAttr
type Process
func FindProcess(pid int) (p *Process, err error)
func StartProcess(name string, argv []string, attr *ProcAttr) (*Process, error)
func (p *Process) Signal(sig Signal) error
func (p *Process) Kill() error
func (p *Process) Wait() (*ProcessState, error)
func (p *Process) Release() error
type ProcessState
func (p *ProcessState) Pid() int
func (p *ProcessState) Exited() bool
func (p *ProcessState) Success() bool
func (p *ProcessState) SystemTime() time.Duration
func (p *ProcessState) UserTime() time.Duration
func (p *ProcessState) Sys() interface{}
func (p *ProcessState) SysUsage() interface{}
func (p *ProcessState) String() string
```

##### 库os的const

```
const (
    O_RDONLY int = syscall.O_RDONLY // 只读模式打开文件
    O_WRONLY int = syscall.O_WRONLY // 只写模式打开文件
    O_RDWR   int = syscall.O_RDWR   // 读写模式打开文件
    O_APPEND int = syscall.O_APPEND // 写操作时将数据附加到文件尾部
    O_CREATE int = syscall.O_CREAT  // 如果不存在将创建一个新文件
    O_EXCL   int = syscall.O_EXCL   // 和O_CREATE配合使用，文件必须不存在
    O_SYNC   int = syscall.O_SYNC   // 打开文件用于同步I/O
    O_TRUNC  int = syscall.O_TRUNC  // 如果可能，打开时清空文件
)
```

##### 库os的type File

```
type File struct {
    // 内含隐藏或非导出字段
}
func Create(name string) (file *File, err error)
func Open(name string) (file *File, err error)
func OpenFile(name string, flag int, perm FileMode) (file *File, err error)
func NewFile(fd uintptr, name string) *File
func Pipe() (r *File, w *File, err error)
func (f *File) Name() string
func (f *File) Stat() (fi FileInfo, err error)
func (f *File) Fd() uintptr
func (f *File) Chdir() error
func (f *File) Chmod(mode FileMode) error
func (f *File) Chown(uid, gid int) error
func (f *File) Readdir(n int) (fi []FileInfo, err error)
func (f *File) Readdirnames(n int) (names []string, err error)
func (f *File) Truncate(size int64) error
func (f *File) Read(b []byte) (n int, err error)
func (f *File) ReadAt(b []byte, off int64) (n int, err error)
func (f *File) Write(b []byte) (n int, err error)
func (f *File) WriteString(s string) (ret int, err error)
func (f *File) WriteAt(b []byte, off int64) (n int, err error)
func (f *File) Seek(offset int64, whence int) (ret int64, err error)
func (f *File) Sync() (err error)
func (f *File) Close() error
```

库os的类型定义FileMode

FileMode代表文件的模式和权限位。这些字位在所有的操作系统都有相同的含义，因此文件的信息可以在不同的操作系统之间安全的移植。不是所有的位都能用于所有的系统，唯一共有的是用于表示目录的ModeDir位。

这些被定义的位是FileMode最重要的位。另外9个不重要的位为标准Unix rwxrwxrwx权限（任何人都可读、写、运行）。这些（重要）位的值应被视为公共API的一部分，可能会用于线路协议或硬盘标识：它们不能被修改，但可以添加新的位

```
type FileMode uint32
const (
    // 单字符是被String方法用于格式化的属性缩写。
    ModeDir        FileMode = 1 << (32 - 1 - iota) // d: 目录
    ModeAppend                                     // a: 只能写入，且只能写入到末尾
    ModeExclusive                                  // l: 用于执行
    ModeTemporary                                  // T: 临时文件（非备份文件）
    ModeSymlink                                    // L: 符号链接（不是快捷方式文件）
    ModeDevice                                     // D: 设备
    ModeNamedPipe                                  // p: 命名管道（FIFO）
    ModeSocket                                     // S: Unix域socket
    ModeSetuid                                     // u: 表示文件具有其创建者用户id权限
    ModeSetgid                                     // g: 表示文件具有其创建者组id的权限
    ModeCharDevice                                 // c: 字符设备，需已设置ModeDevice
    ModeSticky                                     // t: 只有root/创建者能删除/移动文件
    // 覆盖所有类型位（用于通过&获取类型位），对普通文件，所有这些位都不应被设置
    ModeType = ModeDir | ModeSymlink | ModeNamedPipe | ModeSocket | ModeDevice
    ModePerm FileMode = 0777 // 覆盖所有Unix权限位（用于通过&获取类型位）
)
```

库os的type FileInfo

```
type FileInfo interface {
    Name() string       // 文件的名字（不含扩展名）
    Size() int64        // 普通文件返回值表示其大小；其他文件的返回值含义各系统不同
    Mode() FileMode     // 文件的模式位
    ModTime() time.Time // 文件的修改时间
    IsDir() bool        // 等价于Mode().IsDir()
    Sys() interface{}   // 底层数据来源（可以返回nil）
}
```

##### 库os的函数Create

```
func Create(name string) (file *File, err error)
```

##### 库os的函数Open

```
func Open(name string) (file *File, err error)
```

##### 库os的函数OpenFile

```
func OpenFile(name string, flag int, perm FileMode) (file *File, err error)
```

##### 库os的函数OpenFile

```
func NewFile(fd uintptr, name string) *File
```